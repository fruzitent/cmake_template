#!/bin/sh

set -ex

docker buildx build . \
    --build-arg "IMAGE=alpine" \
    --file "./docker/Dockerfile" \
    --platform "linux/amd64,linux/arm64" \
    --tag "ghcr.io/cpp-best-practices/cmake_template:latest-alpine" \
    --target "linux-runner" \
    ;

docker buildx build . \
    --build-arg "IMAGE=ubuntu" \
    --build-arg "STRATEGY=native" \
    --file "./docker/Dockerfile" \
    --output "dest=./_artifact/,type=local" \
    --platform "linux/amd64,linux/arm64" \
    --target "linux-artifact" \
    ;

docker buildx build . \
    --build-arg "IMAGE=ubuntu" \
    --build-arg "STRATEGY=native" \
    --file "./docker/Dockerfile" \
    --platform "linux/amd64,linux/arm64" \
    --tag "ghcr.io/cpp-best-practices/cmake_template:latest-ubuntu" \
    --target "linux-runner" \
    ;

docker buildx build . \
    --build-arg "IMAGE=ubuntu" \
    --build-arg "STRATEGY=native" \
    --file "./docker/Dockerfile" \
    --output "dest=./_artifact/,type=local" \
    --platform "linux/amd64,linux/arm64" \
    --target "linux-artifact" \
    ;
